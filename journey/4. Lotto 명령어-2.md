fㅓ리# 4. Lotto 명령어-2

안녕하세요? 벌써 4번째 문서네요.

근데 여기까지만 할 것을 생각 해 보고, 그 뒤는 생각해 보지 않아서.. 아마도 이게 마지막 문서가 되지 않을까 싶네요.

짧은 시간이었겠지만(1일 1문서하면 일주일도 안 걸리는데) 실력은 생각보다 많이 올라갔을 것으로 생각합니다. (아마도?)

??: 실력이 올라갔을겁니다, 누가 가르쳤는데! ~~누가 배웠는데~~

아무튼, 지금까지 뭔가 1% 부족한 것 같던 느낌이, 지금까지 읽어오면서 해소되었거나, 앞으로 어떤 걸 더 찾아봐야겠다는 생각이 든다면,

이번 강좌에서 시간을 낭비하지 않았다고, 스스로 대견하다고 쓰담쓰담해주세요.

너무 서론부터 종강(?)멘트 같았네요.

오늘도 포인트만 짚으면서 넘기겠습니다. (만, 항상 자세해짐..ㅋㅋ)

---

지금까지의 문서 스타일이라면 Lotto 명령어는 분명 [하나의 파일](./3.%20Lotto%20명령어.md)에서 끝냈어야 했틀텐데.. 라는 생각 했죠?

그런데, 이렇게 문서를 따로 뺸 이유가 있습니다.

바로, [지난 문서](./3.%20Lotto%20명령어.md)의 떡밥 회수시간~!

[지난 문서](./3.%20Lotto%20명령어.md)의 초반에 로또를 설명하면서,

`일단, 금액은 이번 문서에서는 구현하지 않을 예정입니다.` 이런 말 했던 거, 기억 나시나요?

그걸 오늘 구현해 볼 겁니다. 바로, **DataBase**를 이용해서 말이죠.

그리고, 곁다리로 조금 더 깔끔하게 정리까지 진행해 볼게요.

일단, 중요한 **DataBase** 부분먼저 끝내놓고, 그 다음에 `commands/lotto.go` 파일을 정리하는 방향으로 가겠습니다.

---

## DATABASE

데이터베이스, 줄여서 데베가 아니라 DB. 별명으로는 디비디비딥이라고 불리는데,

"해커가 내부 데이터베이스에 무단 접근해 고객 정보가 외부로 유출됐다.", "해당 기업은 데이터베이스 보안 강화 조치를 즉시 시행하겠다고 밝혔다",

"수사당국은 데이터베이스 로그 기록을 분석해 침입 경로를 추적하고 있다.", "데이터베이스의 체계적 관리로 업무 효율성과 데이터 신뢰도가 크게 향상됐다."

이런 말 들어 보신 적 있으신가요?

뭐가 그렇게 중요하길래, 뉴스에서는 계속 디비디비 거리는지..?

네, 진짜 개중요합니다. 그래서 실제로, "데이터베이스 프로그래밍", "데이터베이스 구축과 설계" 등 과목명에도 딱! 박혀있고, 오직 데이터베이스만를 배우기 위한 과목이 존재합니다.

---

### DB의 필요성

DB.. 사실 초반에는 필요가 없습니다. **수기로 관리**하면 되니깐요.

예를 들어, 지금처럼 로또 시스템을 이용해 당첨이 된다면, 누군가가 `손가락이슈-28,699,300,884원 (1등당첨)` 이런식으로 계속 기록을 업데이트해도 충분하죠.

그리고, 못 믿는 누군가를 위해 공개적인 곳에다가 믿을 수 있는 한 놈, 관리자가 직접 업데이트를 해 줘서, 필요할 떄 마다 금액을 더하거나 빼도 충분할 겁니다.

그런데, 여기서는 "사람"이 직접 관리해서, 실수가 발생할 수도 있고, 저장할 데이터가 많아진다면요? 그걸 사람이 어떻게 다 관리하나요? 그리고, 자동화도 거의 안 될 겁니다.

이를 보완하기 위해, 간단하면서도 쉬운 방법이 존재합니다.

지금까지도 계속 사용했던, **프로그램에다가 저장**하는 신박한 방법이죠. 즉, 메모리(변수)에 저장하는 방법입니다.

이제, 사람이 아니라 "컴퓨터"과 관리하니까 실수할 가능성이 확연히 낮아질거고, 저장할 데이터가 많아도 문제가 없어지죠. 그리고, 자동화도 쉬울 겁니다.

그런데, 이렇게 되면 치명적인 문제가 존재하게 됩니다.

바로, 프로그램이 종료되면 데이터가 모두 사라지게 됩니다.

그러면 이 점만 해결하면 되겠네요? 1번 문서에서 보안 관련해서 진행했던 방법을 떠올려 보세요.

파일에다가 디스코드 봇 토큰(데이터)을 저장해서, 필요할 때마다 불러오는 방법이 있겠죠?

네, **데이터를 파일에 저장**하게 된다면, 프로그램이 종료되어도 데이터는 보존될 겁니다.

이 정도면 문제가 크게 없을 거니까, "ㅇㅋ. 난 데이터를 파일에 저장만 해도 되겠다."라고 생각할 수도 있습니다.

물론, 그렇게 생각한다면 여기서 멈춰서 개발하면 됩니다. 실제로, 작은 규모에서는 굳이 DB까지 안 가고, 여기서 끝내는 경우가 많죠.

그렇다면, 여기서 어딘가 불편하니까 DB로 넘어가겠죠?

아무래도 가장 큰 문제는, **같은 파일을 두 개의 프로그램이 공유함으로써 발생하는 문제**가 존재하기 때문일 겁니다.

이를 쉽게 증명할 수 있는 방법이 있는데, 텍스트 파일을 하나 만들어 볼게요.

그리고, 메모장을 하나 더 실행해서, `Ctrl O`를 눌러, 그 텍스트 파일을 선택해서 같은 텍스트파일을 2개의 창으로 띄워보세요.

이제, 하나의 창에다가 수정(저장X)하고, 다른 창에도 수정(저장X)해 줍니다.

이제, 하나의 창을 저장하게 된다면, 다른 창에서는

"저장하지 않은 변경 내용을 유지하시겠습니까? - [경로]에 저장되지 않은 변경 내용이 메모장에 있습니다. 다른 앱에서도 이 파일에 대한 변경 사항이 있습니다. 파일을 다시 열면 메모장에서 저장하지 않은 변경 내용이 삭제죕니다."

이런 알림창이 나오고, "변경 내용 유지 / 모두 보관 / 파일 다시 열기"를 선택하게끔 되어 있습니다.

이렇게 물어보게 되는 이유가, 크게 동시성 문제에 따른 데이터 무결성이 깨질 수 있기 때문입니다.

동시성 문제는 말 그대로, "동시"에 같은 데이터나 파일을 수정하려고 할 때, 순서에 따라서 의도하지 않은 데이터로 바뀔 수 있는 문제이고,

데이터 무결성 원칙은 無(없을 무)를 써서, 데이터의 정보가 변경되거나 오염되지 않도록 하는 원칙을 말합니다.

**DB를 선택하게 된다면, 여러 프로그램이 동시에 같은 데이터를 접근해도, 무결성과 일관성을 보장할 수 있어, 데이터가 꼬이거나 손상되는 일을 방지할 수 있습니다.**

또한, 이 외에도 **효율적으로 데이터 검색과 집계가 가능하고, 데이터 중복 최소화, 확장성과 유연성 등의 이점도 존재**하게 됩니다.

그러니까, 다시 말할게요.

만약 하나의 파일이 하나의 프로그램에 의해서만 동작한다면 그냥 파일로 저장하는 게 더 효율적일거고, 비용절감측면에서도 탁월한 선택일 겁니다.

그러나, 지금은 "공부"하는 상황이니까, 다른 프로그램에서 동시에 데이터를 접근해서, 안전하게 다뤄야 한다는 가정하에 DB를 선택하겠습니다.

DB를 선택할지, 파일선에서 끝낼 지는 "개발자가 판단하에 선택"하는 것입니다.

---

### DB 선택하기

DB는 여러 종류가 존재합니다.

크게는 "관계형"과 "비관계형"으로 구분할 수 있고, 그 안에서도 여러가지 종류가 있습니다.

관계형은 Relational Database Management System, 줄여서 RDBMS라고 불리는데,

쉽게는 엑셀처럼 데이터를 저장하는데, SQL이라는 표준 언어로 데이터를 조회, 추가, 수정, 삭제합니다.

역사가 오래된 만큼, 가장 널리 사용된 표준적인 데이터베이스입니다.

대표적으로 MySQL이라던가, PostgreSQL, Oracle 등이 존재하는데, 일반적으로 DB를 처음 공부할 때 가장 많이 접하게 될 녀석들입니다.

다음으로는 비관계형이라고 하면서, 영어 약자로는 NoSQL이라고 부릅니다.

비관계형이 NoSQL이라.. 그럼 관계형은 SQL이고, 비관계형은 SQL을 안 쓴다는 의미인가? 싶을 수 있지만

사실 NoSQL은 Not only SQL의 약자로, 전통적인 RDBMS에서 사용하는 SQL만 사용하는 것이 아니라,

테이블 기반이 아닌 문서나, 키-값, 그래프 등 다양한 구조로 데이터를 저장할 수 있는 데이터베이스를 의미합니다.

대표적으로는 MongoDB가 있는데, 최근 개발 프로젝트같은 곳에서 많이 사용하고 있는 추세입니다.

이 문서에서는, 전통적으로 DB를 다뤄주기 위해 MySQL을 선택하겠습니다. (이 선택또한, 개발자가 판단하에 선택하는 것입니다.)

---

## MySQL 세팅하기

MySQL도 하나의 서버-클라이언트 통신 프로그램이기 때문에, 세팅이 필요합니다.

[MySQL Community Donwloads](https://dev.mysql.com/downloads/)에 들어가서, 버전에 맞는 설치프로그램을 다운로드 해 주세요.

서버(MySQL Community Server, 필수)와 클라이언트(MySQL Workbench, 선택)를 다운로드 해 줍니다.

---

### MySQL Server 설치

서버를 설치하면, MySQL Configurator가 뜰텐데,

Perform an in-place upgrade of the existing MySQL Server installation(첫 번째 옵션)은 기존 서버를 업그레이드(덮어쓰기)하는 방식입니다.

Configure this server instance as a side-by-side installation(두 번째 옵션)은 별도의 instance를 새롭게 설치 및 구성됩니다.

지금은 새롭게 MySQL 서버를 설치하는 상황이므로, 2번째 옵션을 선택해 줍니다.

바로 나오는 `C:\ProgramData\MySQL\MySQL Server 8.4\` 이 경로는 실제 DB가 저장되는 경로입니다. 특별한 경우가 아니라면, 기본 경로를 그대로 두는 것을 추천합니다.

그리고, 계정은 알아서 설정해 준 후, 나머지는 모두 기본으로 설정하고 설치해 줍니다.

---

### MySQL Workbench 설치

이어서, MySQL Workbench를 설치해 줍니다.

그리고, MySQL Connections에 "+" 버튼을 눌러, 설정해 줍니다.

이때, 서버 주소는 `127.0.0.1`로 되어 있는지, 포트는 `3306`인지,

Username은 아까 서버 설정 할 때 만든 계정 ID로 Password 항목에서 `Store in Vault ...`을 클릭해, 아까 서버 설정 할 때 만든 계정 PW를 넣어줍니다.

그리고, 우측하단에 있는 Test Connection 버튼을 누르고, Continue Anyway를 눌러, 정상적으로 서버 설정이 되었는지 확인해 줍니다.

---

### Go에서 MySQL 사용하기

[1. Discord 봇 로그인](./1.%20Discord%20봇%20로그인.md) 에서 Go에서 Discord 라이브러리를 사용하기 위해 받았던 거 기억나시나요?

이번에도 마찬가지로, Go에서 MySQL 서버와 통신하기 위해, 라이브러리를 설치해줘야 합니다.

여기서 사용할 라이브러리는 [Go-MySQL-Driver](https://pkg.go.dev/github.com/go-sql-driver/mysql) 입니다.

이제 능력치가 쌓였으니, 직접 문서 읽어보긴 해야겠죠?
